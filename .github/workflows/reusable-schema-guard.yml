name: Reusable Schema Guard

on:
  workflow_call:
    inputs:
      paths:
        required: true
        type: string
    secrets:
      ORG_READ_TOKEN:
        required: true

permissions:
  contents: read

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout consumer repo
        uses: actions/checkout@v4

      - name: Checkout core schema repo
        uses: actions/checkout@v4
        with:
          repository: zkpip/zkpip
          ref: v0.1.0
          token: ${{ secrets.ORG_READ_TOKEN }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install dependencies
        run: npm ci --ignore-scripts

      - name: Run schema validation
        run: |
          echo "Validating JSON files against core schema..."
          node ./packages/core/scripts/validate-samples.mjs ${{ inputs.paths }}
